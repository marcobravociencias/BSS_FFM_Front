<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.totalplay.ffm.plantainterna.repository.SkillsRepository">

	<select id="selectHorario"
		resultType="com.totalplay.ffm.plantainterna.model.catalogoVO">
		SELECT
		FCST_ID ID,
		TO_CHAR(FCST_START_TIME,'HH24:MI') ||'-'||TO_CHAR(FCST_END_TIME,'HH24:MI') DESCRIPCION
		FROM FFM_CAT_SCHEDULES_TEC
		WHERE FCST_ACTIVE=1
		ORDER BY TO_CHAR(FCST_START_TIME,'HH24:MI') ASC
	</select>
	
	<select id="obtenerIntervencionesSkillsDisp"
			resultType="com.totalplay.ffm.plantainterna.model.IntervencionSkillVO">	
			SELECT FCI_ID AS ID,FCI_DESCRIPTION AS DESCRIPCION FROM FFM_CAT_INTERVENTION 
			WHERE FCI_APLICA_SKILL=1 AND FCI_TIER=2
	</select>
	
	<select id="obtenerTecnicosSkillsDisp" resultType="com.totalplay.ffm.plantainterna.model.TecnicoSoporteTemp">	
		SELECT PT.FAP_FFO_ID AS IDUSUARIO,OP.FFO_EMPLOYEE_NUMBER AS USUARIO,OP.FFD_NAMES || ' ' || OP.FFD_MIDDLE_NAME || ' ' || 
		OP.FFD_LAST_NAME AS NOMBRETECNICO,MAX(PT.FAP_FECHA_INGRESO) AS FECHA_ACTUALIZACION,MAX(WHT.FWHT_MONDAY) AS IDHORARIO,
		LISTAGG(PT.FAP_FCI_ID,',')WITHIN GROUP(ORDER BY PT.FAP_FCI_ID)AS SKILLS FROM TPASAPSEC.FFM_PRIVILEGES_TEC PT
		INNER JOIN TPASAPSEC.FFM_FIELD_OPERATIONS OP ON OP.FFO_ID=PT.FAP_FFO_ID AND OP.FFO_ACTIVE=1
		INNER JOIN TPASAPSEC.FFM_CREW_OPERATOR CO ON CO.FFO_ID=OP.FFO_ID
		INNER JOIN TPASAPSEC.FFM_CREW C ON C.FCW_ID=CO.FCW_ID 
		LEFT JOIN TPASAPSEC.FFM_CAT_INTERVENTION CI ON CI.FCI_ID=PT.FAP_FCI_ID AND CI.FCI_APLICA_SKILL=1 AND CI.FCI_TIER=2	
		LEFT JOIN TPASAPSEC.FFM_WORKING_HOURS_TEC WHT ON WHT.FWHT_FFO_ID=OP.FFO_ID
		GROUP BY PT.FAP_FFO_ID,OP.FFO_EMPLOYEE_NUMBER,OP.FFD_NAMES || ' ' || OP.FFD_MIDDLE_NAME || ' ' || OP.FFD_LAST_NAME
	</select>
	
</mapper>